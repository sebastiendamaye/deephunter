{% load qm_extras %}

{% if analytics %}
    <table class="mitre">
        <tr>
            <th>Admin/Stats/Run</th>
            <th>Connector</th>
            <th>Analytic</th>
            <th>Status</th>
            <th>Maxhosts Count</th>
            <th>Run daily</th>
            <th>Category</th>
            <th>Message</th>
            <th>Error date</th>
        </tr>
    {% for analytic in analytics %}
        <tr>
            <td>
                {% if perms.qm.change_analytic %}<a class="button" target="_blank" href="/admin/qm/analytic/{{ analytic.id }}/change/">admin</a>{% endif %}
                {% if perms.qm.view_snapshot %}<a class="button" target="_blank" href="/qm/{{ analytic.id }}/trend/">stats</a>{% endif %}
                {% if perms.qm.run_query %}<a class="button" target="_blank" href="/qm/events/{{ analytic.id }}/">run&nbsp;query</a>{% endif %}
            </td>
            <td>{{ analytic.connector_name }}</td>
            <td title="DESCRIPTION:&#013;===========&#013;{{ analytic.description }}&#013;&#013;QUERY:&#013;===========&#013;{{analytic.query}}">{{ analytic.name }}</td>
            <td><div class="{{ analytic.status|lower }}">{{ analytic.status }}</div></td>
            <td class="acenter">{{ analytic.maxhosts_count }}</td>
            <td class="acenter">
                {% if analytic.run_daily %}
                    <img src="/static/admin/img/icon-yes.svg" alt="yes" />
                {% else %}
                    <img src="/static/admin/img/icon-no.svg" alt="no" />
                {% endif %}
            </td>
            <td>{% if analytic.error_is_info %}
                <div class="msg_warning">INFO</div>
            {% else %}
                <div class="msg_error">ERROR</div>
            {% endif %}</td>
            <td><pre>{{ analytic.query_error_message }}</pre></td>
            <td>{{ analytic.query_error_date }}</td>
        </tr>	
    {% endfor %}
    </table>

    <div class="pagination">
        <span class="step-links">
            <span class="previous">
                {% if analytics.has_previous %}
                <a href="?page={{ analytics.previous_page_number }}">Previous</a>
                {% endif %}
            </span>

            <span class="current">
                {% for i in analytics.paginator.num_pages|to_range %}
                    {% if i == analytics.number %}
                        <span class="pagelink">{{ i }}</span>
                    {% else %}
                        <span class="pagelink"><a href="?page={{ i }}">{{ i }}</a></span>
                    {% endif %}
                {% endfor %}
            </span>

            <span class="next">
                {% if analytics.has_next %}
                    <span class="next"><a href="?page={{ analytics.next_page_number }}">Next</a></span>
                {% endif %}
            </span>
        </span>
    </div>

{% else %}
    <p>No analytics with errors found.</p>
{% endif %}